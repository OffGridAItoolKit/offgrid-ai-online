<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OffGrid AI ToolKit Online - Cloud-Powered Gemma 3</title>
    <meta name="description" content="Experience the power of Gemma 3 AI models online. Fast, private, and powerful AI assistant for survivalists, homesteaders, and off-grid enthusiasts.">
    
    <!-- Open Graph / Social Sharing Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://offgridtoolkit.ai/">
    <meta property="og:title" content="OffGrid AI ToolKit Online - Cloud-Powered Gemma 3">
    <meta property="og:description" content="Experience the power of Gemma 3 AI models online. Fast, private, and powerful AI assistant for survivalists, homesteaders, and off-grid enthusiasts.">
    <meta property="og:image" content="https://offgridtoolkit.ai/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="1200">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://offgridtoolkit.ai/">
    <meta name="twitter:title" content="OffGrid AI ToolKit Online - Cloud-Powered Gemma 3">
    <meta name="twitter:description" content="Experience the power of Gemma 3 AI models online. Fast, private, and powerful AI assistant for survivalists, homesteaders, and off-grid enthusiasts.">
    <meta name="twitter:image" content="https://offgridtoolkit.ai/og-image.png">
    <link rel="icon" type="image/png" href="compasstilted.png">
    <link rel="stylesheet" href="offgridai.css?v=2.0">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Online Version Specific Styles */
        .online-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 12px;
        }
        
        .online-badge::before {
            content: '‚ö°';
        }
        
        .purchase-cta {
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #2c1810 0%, #4a2c1a 100%);
            color: #daa520;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            border: 2px solid #b8860b;
            cursor: pointer;
        }
        
        .purchase-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(184, 134, 11, 0.4);
            background: linear-gradient(135deg, #3d2216 0%, #5a3c2a 100%);
            color: #f0c040;
        }
        
        .speed-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: #10b981;
            margin-left: 8px;
        }
        
        .privacy-notice {
            background: linear-gradient(135deg, rgba(44, 24, 16, 0.95) 0%, rgba(74, 44, 26, 0.95) 100%);
            border: 1px solid #b8860b;
            border-radius: 8px;
            padding: 12px 16px;
            margin: 16px 0;
            font-size: 13px;
            color: #deb887;
        }
        
        .privacy-notice strong {
            color: #daa520;
        }
        
        .model-speed-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: #10b981;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }
        
        /* Disabled model styling */
        .disabled-model {
            opacity: 0.5;
            cursor: not-allowed !important;
        }
        
        .disabled-model:hover {
            background: transparent !important;
        }
        
        /* Hide offline-specific elements */
        #qrContainer, #driveBadge, .desktop-only, #firewallModal, #mobileAccessHelper {
            display: none !important;
        }
        
        /* Adjust messages padding for online version */
        .messages {
            padding-right: 24px !important;
        }
        
        /* Welcome screen adjustments */
        .welcome-subtitle {
            color: #10b981;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        /* Response time display */
        .response-time {
            font-size: 11px;
            color: #10b981;
            margin-left: 44px;
            margin-bottom: 4px;
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(44, 24, 16, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        /* Prompt Accordion Styles */
        .prompt-accordion-container {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .prompt-category {
            border-radius: 8px;
            overflow: hidden;
        }
        
        .prompt-category-toggle {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: rgba(44, 24, 16, 0.6);
            border: 1px solid rgba(184, 134, 11, 0.3);
            border-radius: 8px;
            color: #deb887;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }
        
        .prompt-category-toggle:hover {
            background: rgba(184, 134, 11, 0.15);
            border-color: rgba(184, 134, 11, 0.5);
        }
        
        .prompt-category-toggle.active {
            background: rgba(184, 134, 11, 0.2);
            border-color: #b8860b;
            color: #daa520;
        }
        
        .category-icon {
            font-size: 14px;
        }
        
        .category-name {
            flex: 1;
        }
        
        .category-arrow {
            font-size: 10px;
            transition: transform 0.2s ease;
        }
        
        .prompt-category-toggle.active .category-arrow {
            transform: rotate(180deg);
        }
        
        .prompt-list {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0 0 8px 8px;
        }
        
        .prompt-list.open {
            max-height: 500px;
            border: 1px solid rgba(184, 134, 11, 0.2);
            border-top: none;
        }
        
        .prompt-item {
            padding: 10px 12px;
            font-size: 12px;
            color: #deb887;
            cursor: pointer;
            border-bottom: 1px solid rgba(184, 134, 11, 0.1);
            transition: all 0.2s ease;
        }
        
        .prompt-item:last-child {
            border-bottom: none;
        }
        
        .prompt-item:hover {
            background: rgba(184, 134, 11, 0.1);
            color: #f5e6d3;
        }
        
        .prompt-item-image {
            background: rgba(218, 165, 32, 0.1);
            border-left: 3px solid #daa520;
        }
        
        .prompt-item-image:hover {
            background: rgba(218, 165, 32, 0.2);
        }
        
        /* Copy Toast Notification */
        .copy-toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            animation: toastIn 0.3s ease, toastOut 0.3s ease 1.7s forwards;
        }
        
        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
        
        @keyframes toastOut {
            from {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            to {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
        }
        
        /* Info Content Styles for Welcome Boxes */
        .info-content {
            text-align: left;
            line-height: 1.7;
        }
        
        .info-content h3 {
            color: #daa520;
            font-size: 1.3em;
            margin: 20px 0 12px 0;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(184, 134, 11, 0.3);
        }
        
        .info-content h3:first-child {
            margin-top: 0;
        }
        
        .info-content p {
            margin: 12px 0;
            color: #f5e6d3;
        }
        
        .info-content ul {
            margin: 12px 0;
            padding-left: 20px;
        }
        
        .info-content li {
            margin: 8px 0;
            color: #deb887;
        }
        
        .info-content strong {
            color: #daa520;
        }
        
        .info-content .highlight-box {
            background: rgba(184, 134, 11, 0.1);
            border: 1px solid rgba(184, 134, 11, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        
        .info-content .cta-box {
            background: linear-gradient(135deg, rgba(184, 134, 11, 0.2) 0%, rgba(218, 165, 32, 0.2) 100%);
            border: 2px solid #b8860b;
            border-radius: 12px;
            padding: 20px;
            margin: 24px 0 16px 0;
            text-align: center;
        }
        
        .info-content .cta-box h4 {
            color: #daa520;
            font-size: 1.1em;
            margin-bottom: 12px;
        }
        
        .info-content .cta-button {
            display: inline-block;
            background: linear-gradient(135deg, #b8860b 0%, #daa520 100%);
            color: #1a0f05;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .info-content .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(184, 134, 11, 0.4);
        }
        
        .info-content .model-card {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(184, 134, 11, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
        }
        
        .info-content .model-card h4 {
            color: #daa520;
            margin-bottom: 8px;
        }
        
        .info-content .model-card .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .info-content .model-card .badge-fast {
            background: #10b981;
            color: white;
        }
        
        .info-content .model-card .badge-smart {
            background: #8b5cf6;
            color: white;
        }
        
        .info-content .model-card .badge-medical {
            background: #ef4444;
            color: white;
        }
        
        .info-content .use-case-item {
            background: rgba(0, 0, 0, 0.15);
            border-left: 3px solid #b8860b;
            padding: 12px 16px;
            margin: 12px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .info-content .use-case-item h4 {
            color: #daa520;
            margin-bottom: 6px;
            font-size: 1em;
        }
        
        .info-content .use-case-item p {
            margin: 0;
            font-size: 0.95em;
            color: #deb887;
        }
        
        .info-content .benchmark-table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 0.9em;
        }
        
        .info-content .benchmark-table th {
            background: rgba(184, 134, 11, 0.2);
            color: #daa520;
            padding: 10px;
            text-align: left;
            border-bottom: 2px solid rgba(184, 134, 11, 0.3);
        }
        
        .info-content .benchmark-table td {
            padding: 10px;
            border-bottom: 1px solid rgba(184, 134, 11, 0.1);
            color: #deb887;
        }
        
        .info-content .benchmark-table tr:hover {
            background: rgba(184, 134, 11, 0.05);
        }
        
        .info-content .continue-prompt {
            color: #10b981;
            font-style: italic;
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid rgba(184, 134, 11, 0.2);
        }
    </style>
</head>
<body>
    <!-- First Run Banner (Online Version) -->
    <div id="firstRunBanner" class="first-run-banner" style="display: none;">
        <div class="first-run-content">
            <div class="first-run-logo">OffGrid AI ToolKit <span class="online-badge">ONLINE</span></div>
            <div class="first-run-tagline">Cloud-Powered Gemma 3 ‚Ä¢ Fast Responses ‚Ä¢ Private Sessions</div>
            <div class="first-run-message">
                <p><strong>Welcome!</strong> This is the online demo of OffGrid AI ToolKit.</p>
                <p>‚ö° Experience lightning-fast AI responses powered by cloud infrastructure</p>
                <p>üîí Your conversations are NOT stored - sessions are completely ephemeral</p>
                <p>üß† Same Gemma 3 models as the offline USB version</p>
                <div class="privacy-notice">
                    <strong>Privacy First:</strong> We don't store your conversations. Each session is independent and private.
                </div>
            </div>
            <div class="first-run-terms">
                <label class="terms-checkbox">
                    <input type="checkbox" id="acceptTermsBanner">
                    <span>I understand this is a demo and accept the <a href="https://offgridaitoolkit.com/pages/terms-of-service" target="_blank">terms of service</a></span>
                </label>
            </div>
            <button id="acceptBannerBtn" class="first-run-button" onclick="acceptFirstRun()" disabled>
                Start Using OffGrid AI Online
            </button>
            <div class="first-run-footer">
                Want complete privacy & offline access? <a href="https://offgridaitoolkit.com" target="_blank" style="color: #daa520; font-weight: 600;">Get the USB Version ‚Üí</a>
            </div>
        </div>
    </div>

    <div class="header">
        <div class="header-left">
            <div class="logo" onclick="returnToHome()" style="cursor: pointer;" title="Clear chat and return to home">
                <img src="compasstilted.png" alt="OffGrid AI" style="width: 32px; height: 32px;">
            </div>
            <h1 class="title">OffGrid AI ToolKit</h1>
            <span class="online-badge">ONLINE</span>
        </div>
        <div style="display: flex; align-items: center; gap: 16px;">
            <a href="https://offgridaitoolkit.com" target="_blank" class="purchase-cta">
                üõí Get Offline Version
            </a>
            <div class="status">
                <span class="status-dot disconnected" id="statusDot"></span>
                <span id="statusText" class="status-text">Connecting...</span>
            </div>
        </div>
    </div>

    <!-- Upload Indicator -->
    <div class="upload-indicator" id="uploadIndicator">
        <div style="margin-bottom: 10px;">üì∏</div>
        <div>Processing Image...</div>
        <div style="font-size: 12px; margin-top: 5px;">Please wait</div>
    </div>

    <div class="main-container">
        <!-- Resources Sidebar -->
        <div class="sidebar" id="sidebar">
            <!-- Online Info Section -->
            <div class="sidebar-section">
                <div class="sidebar-title">‚ö° Online Version</div>
                <div class="privacy-notice" style="margin: 0 0 12px 0; padding: 10px;">
                    <strong>üîí Privacy:</strong> Conversations are not stored. Each session is ephemeral.
                </div>
            </div>

            <!-- Quick Tools Section -->
            <div class="sidebar-section">
                <div class="sidebar-title">Quick Tools</div>
                <button class="tool-button" onclick="clearChat()">üìã Clear Chat / Home</button>
                <button class="tool-button" onclick="setupTranslator()">üåê Translator</button>
                <button class="tool-button" onclick="openImageIdentifier()">üîç Image Identifier</button>
            </div>

            <!-- Quick Prompts Accordion Section -->
            <div class="sidebar-section">
                <div class="sidebar-title">Quick Prompts</div>
                <div class="prompt-accordion-container">
                    <!-- üî• Survival & Emergency -->
                    <div class="prompt-category" data-category="survival">
                        <button class="prompt-category-toggle" onclick="togglePromptCategory('survival')">
                            <span class="category-icon">üî•</span>
                            <span class="category-name">Survival & Emergency</span>
                            <span class="category-arrow">‚ñº</span>
                        </button>
                        <div class="prompt-list" id="survival-prompts">
                            <div class="prompt-item" onclick="copyPrompt(this)">List priorities: shelter vs water vs fire in different climates</div>
                            <div class="prompt-item" onclick="copyPrompt(this)">How do I make char cloth for fire starting</div>
                            <div class="prompt-item" onclick="copyPrompt(this)">How do I prepare for an evacuation with only 10 minutes' notice</div>
                            <div class="prompt-item" onclick="copyPrompt(this)">What's the safest way to move through a city during riots</div>
                            <div class="prompt-item prompt-item-image" onclick="copyPrompt(this)">[Take picture or upload image] Are these berries safe to eat or should they be avoided?</div>
                        </div>
                    </div>
                    
                    <!-- ‚öïÔ∏è Healthcare & First Responders -->
                    <div class="prompt-category" data-category="healthcare">
                        <button class="prompt-category-toggle" onclick="togglePromptCategory('healthcare')">
                            <span class="category-icon">‚öïÔ∏è</span>
                            <span class="category-name">Healthcare & First Responders</span>
                            <span class="category-arrow">‚ñº</span>
                        </button>
                        <div class="prompt-list" id="healthcare-prompts">
                            <div class="prompt-item" onclick="copyPrompt(this)">How can you tell the difference between a bacterial and viral respiratory infection</div>
                            <div class="prompt-item" onclick="copyPrompt(this)">Describe the symptoms that distinguish appendicitis from general stomach pain</div>
                            <div class="prompt-item" onclick="copyPrompt(this)">What signs indicate that a wound is becoming seriously infected and needs advanced care</div>
                            <div class="prompt-item" onclick="copyPrompt(this)">How do you safely remove a tick and treat the bite afterward</div>
                            <div class="prompt-item prompt-item-image" onclick="copyPrompt(this)">[Take picture or upload image] Look at this bite and identify what insect this might have been</div>
                        </div>
                    </div>
                    
                    <!-- ü•æ Hikers & Hunters -->
                    <div class="prompt-category" data-category="hikers">
                        <button class="prompt-category-toggle" onclick="togglePromptCategory('hikers')">
                            <span class="category-icon">ü•æ</span>
                            <span class="category-name">Hikers & Hunters</span>
                            <span class="category-arrow">‚ñº</span>
                        </button>
                        <div class="prompt-list" id="hikers-prompts">
                            <div class="prompt-item" onclick="copyPrompt(this)">My water filter output suddenly dropped. Here are the conditions. What should I check first</div>
                            <div class="prompt-item" onclick="copyPrompt(this)">Help me fix a broken backpack buckle using common trail items</div>
                            <div class="prompt-item" onclick="copyPrompt(this)">Make a three day backpacking meal plan with calorie counts and pack weights</div>
                            <div class="prompt-item" onclick="copyPrompt(this)">Create a simple safety plan for handling harvested game in warm weather</div>
                            <div class="prompt-item prompt-item-image" onclick="copyPrompt(this)">[Take picture or upload image] Identify this track and explain whether it is fresh or old</div>
                        </div>
                    </div>
                    
                    <!-- üöê Overlanders & Adventurers -->
                    <div class="prompt-category" data-category="overlanders">
                        <button class="prompt-category-toggle" onclick="togglePromptCategory('overlanders')">
                            <span class="category-icon">üöê</span>
                            <span class="category-name">Overlanders & Adventurers</span>
                            <span class="category-arrow">‚ñº</span>
                        </button>
                        <div class="prompt-list" id="overlanders-prompts">
                            <div class="prompt-item" onclick="copyPrompt(this)">What are 3 ways to secure camp in 40mph winds using only rope and tarps</div>
                            <div class="prompt-item" onclick="copyPrompt(this)">Create a 7-day meal plan using only non-refrigerated ingredients</div>
                            <div class="prompt-item" onclick="copyPrompt(this)">What should I check if my engine is overheating in the desert</div>
                            <div class="prompt-item" onclick="copyPrompt(this)">List 10 one-pot meals perfect for overlanding with ingredients from a small cooler</div>
                            <div class="prompt-item prompt-item-image" onclick="copyPrompt(this)">[Take picture or upload image] Identify this plant and explain if it's safe to touch or burn</div>
                        </div>
                    </div>
                    
                    <!-- üë®‚Äçüè´ Remote Educators -->
                    <div class="prompt-category" data-category="educators">
                        <button class="prompt-category-toggle" onclick="togglePromptCategory('educators')">
                            <span class="category-icon">üë®‚Äçüè´</span>
                            <span class="category-name">Remote Educators</span>
                            <span class="category-arrow">‚ñº</span>
                        </button>
                        <div class="prompt-list" id="educators-prompts">
                            <div class="prompt-item" onclick="copyPrompt(this)">Create a hands-on science lesson about water cycles using only outdoor materials</div>
                            <div class="prompt-item" onclick="copyPrompt(this)">Design a week of math activities for grades 3-5 that require no electricity</div>
                            <div class="prompt-item" onclick="copyPrompt(this)">Explain photosynthesis in a way a 10-year-old would understand and remember</div>
                            <div class="prompt-item" onclick="copyPrompt(this)">Create 5 critical thinking exercises using nature observations</div>
                            <div class="prompt-item prompt-item-image" onclick="copyPrompt(this)">[Take picture or upload image] What can you teach students about this natural object</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Get Full Version Section -->
            <div class="sidebar-section">
                <div class="sidebar-title">Get the Full Version</div>
                <a href="https://offgridaitoolkit.com" target="_blank" class="tool-button" style="background: linear-gradient(135deg, #b8860b 0%, #daa520 100%); color: #1a0f05; font-weight: 600; text-decoration: none; display: block; text-align: center;">
                    üõí Purchase USB Version<br>
                    <span style="font-size: 11px; font-weight: 400;">100% Offline ‚Ä¢ Complete Privacy</span>
                </a>
            </div>
        </div>

        <div class="chat-container">
            <div class="messages" id="messages">
                <div class="welcome" id="welcome">
                    <img src="compass.svg" alt="OffGrid AI Compass" class="welcome-icon" style="width: 120px; height: 120px;">
                    <h2>Welcome to OffGrid AI ToolKit</h2>
                    <span class="online-badge welcome-online-badge">ONLINE</span>
                    <div class="welcome-subtitle">‚ö° Cloud-Powered ‚Ä¢ üîí Private Sessions ‚Ä¢ No Data Stored</div>
                    <div class="feature-badges">
                        <div class="feature-badge">üëÅÔ∏è Vision</div>
                        <div class="feature-badge">‚ö° Fast</div>
                        <div class="feature-badge">üîí Private Sessions</div>
                    </div>
                    <p>Experience the same Gemma 3 AI models from the USB version, now with cloud speed!</p>
                    
                    <!-- Desktop buttons -->
                    <div class="quick-actions desktop-quick-actions">
                        <div class="quick-action" onclick="showInfoContent('howItWorks')">
                            <div class="quick-action-title">‚öôÔ∏è How It Works</div>
                            <div class="quick-action-desc">Technology & privacy explained</div>
                        </div>
                        <div class="quick-action" onclick="showInfoContent('useCases')">
                            <div class="quick-action-title">üéØ Use Cases</div>
                            <div class="quick-action-desc">See who uses OffGrid AI</div>
                        </div>
                        <div class="quick-action" onclick="showInfoContent('benchmarks')">
                            <div class="quick-action-title">üìä Testing & Benchmarks</div>
                            <div class="quick-action-desc">Why we chose Gemma 3</div>
                        </div>
                        <div class="quick-action" onclick="showInfoContent('modelSelection')">
                            <div class="quick-action-title">üß† Model Selection</div>
                            <div class="quick-action-desc">Choose the right model</div>
                        </div>
                    </div>
                    
                    <!-- Mobile buttons -->
                    <div class="mobile-quick-actions">
                        <div class="quick-action" onclick="triggerImageUpload()">
                            <div class="quick-action-icon">üì∏</div>
                            <div class="quick-action-content">
                                <div class="quick-action-title">Take Picture</div>
                                <div class="quick-action-desc">Camera capture</div>
                            </div>
                        </div>
                        <div class="quick-action" onclick="triggerGalleryUpload()">
                            <div class="quick-action-icon">üñºÔ∏è</div>
                            <div class="quick-action-content">
                                <div class="quick-action-title">Upload Image</div>
                                <div class="quick-action-desc">From gallery</div>
                            </div>
                        </div>
                        <div class="quick-action" onclick="setupTranslator()">
                            <div class="quick-action-icon">üåê</div>
                            <div class="quick-action-content">
                                <div class="quick-action-title">Translator</div>
                                <div class="quick-action-desc">Quick translate</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="input-area">
        <div class="input-container">
            <div class="input-wrapper">
                <input type="file" id="imageInput" class="image-upload-input" accept="image/*" capture="environment" onchange="handleImageSelect(event)">
                <input type="file" id="galleryInput" class="image-upload-input" accept="image/*" onchange="handleImageSelect(event)">
                
                <!-- Camera Icon - Takes Photo -->
                <svg class="image-upload-btn" onclick="triggerImageUpload()" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" title="Take Photo">
                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                    <circle cx="12" cy="13" r="4"></circle>
                </svg>
                
                <!-- Gallery Icon - Upload from Gallery -->
                <svg class="gallery-upload-btn" onclick="triggerGalleryUpload()" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" title="Upload Image">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
                
                <div class="image-preview" id="imagePreview">
                    <img class="preview-image" id="previewImg" src="" alt="Preview">
                    <div class="preview-info">
                        <div class="preview-filename" id="previewFilename"></div>
                    </div>
                    <button class="remove-image" onclick="removeImage()">Remove</button>
                </div>
                
                <textarea 
                    id="messageInput" 
                    class="message-input"
                    placeholder="Ask anything about survival, homesteading, or upload an image..."
                    rows="1"
                    onkeydown="handleKeyDown(event)"
                    oninput="autoResize(this)"
                ></textarea>
            </div>
            
            <div class="button-row">
                <div class="model-selector">
                    <div class="model-helper" id="modelHelper"></div>
                    <button class="model-button" id="modelButton" onclick="toggleModelDropdown()">
                        <span class="model-name" id="selectedModelName">Gemma 3 12B</span>
                        <span class="model-speed-badge">‚ö° Fast</span>
                        <svg viewBox="0 0 16 16" fill="currentColor" style="width: 16px; height: 16px;">
                            <path d="M4.427 7.427l3.396 3.396a.25.25 0 00.354 0l3.396-3.396A.25.25 0 0011.396 7H4.604a.25.25 0 00-.177.427z"/>
                        </svg>
                    </button>
                    
                    <div class="model-dropdown" id="modelDropdown">
                        <div class="model-list">
                            <div class="model-item" onclick="selectModel('gemma-3-4b')">
                                <div class="model-item-name">Gemma 3 4B <span class="model-speed-badge">‚ö° Fastest</span></div>
                                <div class="model-item-desc">Great for quick questions</div>
                            </div>
                            <div class="model-item selected" onclick="selectModel('gemma-3-12b')">
                                <div class="model-item-name">Gemma 3 12B <span class="model-speed-badge">‚ö° Fast</span></div>
                                <div class="model-item-desc">Balanced performance</div>
                            </div>
                            <div class="model-item" onclick="selectModel('gemma-3-27b')">
                                <div class="model-item-name">Gemma 3 27B <span class="model-speed-badge">üß† Smartest</span></div>
                                <div class="model-item-desc">Maximum intelligence</div>
                            </div>
                            <div class="model-item disabled-model" onclick="showOfflineOnlyAlert()">
                                <div class="model-item-name">MedGemma 3 4B <span style="background: #6b7280;" class="model-speed-badge">üîí Offline Only</span></div>
                                <div class="model-item-desc">Available in USB Version</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="send-button" onclick="sendMessage()" id="sendButton">
                    Send
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // OFFGRID AI TOOLKIT ONLINE - MAIN JAVASCRIPT
        // ============================================
        
        // Configuration
        const API_BASE = window.location.origin;
        let selectedModel = 'gemma-3-12b';
        let isTyping = false;
        let selectedImage = null;
        let conversationHistory = [];
        
        // ============================================
        // INFO CONTENT DATA
        // ============================================
        
        const infoContent = {
            howItWorks: {
                title: "How OffGrid AI Works",
                content: `
                    <div class="info-content">
                        <h3>‚ö° Simple & Powerful</h3>
                        <p>OffGrid AI ToolKit is a complete AI system that runs entirely from a USB drive. No installation, no internet required, and your conversations never leave your computer.</p>
                        
                        <div class="highlight-box">
                            <strong>3 Simple Steps:</strong>
                            <ol>
                                <li><strong>Plug in</strong> the USB 3.2 flash drive to any Windows computer</li>
                                <li><strong>Double-click</strong> one file (Launch OffGrid AI ToolKit.exe)</li>
                                <li><strong>Start chatting</strong> with your private AI assistant</li>
                            </ol>
                        </div>
                        
                        <h3>üîí Complete Privacy</h3>
                        <p>Your conversations, questions, and data stay on YOUR device. Nothing is sent to corporate servers, nothing is tracked, and there's no digital footprint. When you unplug the USB, it's like the AI was never there.</p>
                        
                        <h3>üß† Multiple AI Models</h3>
                        <p>The toolkit includes different Gemma 3 models you can switch between:</p>
                        <ul>
                            <li><strong>4B Model:</strong> Quick answers for basic queries</li>
                            <li><strong>12B Model:</strong> Perfect balance of speed and intelligence</li>
                            <li><strong>27B Model:</strong> Maximum reasoning for complex scenarios</li>
                            <li><strong>MedGemma:</strong> Specialized medical knowledge (USB version only)</li>
                        </ul>
                        
                        <h3>üëÅÔ∏è Vision Capabilities</h3>
                        <p>Upload images and the AI will analyze them - identify plants, animals, diagnose vehicle issues, read technical diagrams, and more. Perfect for field use.</p>
                        
                        <h3>üì± Mobile Access</h3>
                        <p>Connect your phone to the same WiFi, scan a QR code, and access the AI from your phone's browser. Your phone becomes the interface while your computer does the processing.</p>
                        
                        <div class="cta-box">
                            <h4>üõí Want Complete Offline Privacy?</h4>
                            <p>Get the USB version for 100% offline operation with no internet required.</p>
                            <a href="https://offgridaitoolkit.com" target="_blank" class="cta-button">Get the USB Version ‚Üí</a>
                        </div>
                        
                        <p class="continue-prompt">üí¨ Have questions? Just ask in the chat below!</p>
                    </div>
                `
            },
            useCases: {
                title: "Who Uses OffGrid AI?",
                content: `
                    <div class="info-content">
                        <h3>üéØ Real-World Applications</h3>
                        <p>OffGrid AI ToolKit is designed for people who need reliable AI assistance anywhere, anytime - even without internet.</p>
                        
                        <div class="use-case-item">
                            <h4>üèïÔ∏è Overlanders & Adventurers</h4>
                            <p>Vehicle diagnostics from dashboard photos, wildlife tracking, gear optimization, weather pattern analysis, and emergency navigation assistance.</p>
                        </div>
                        
                        <div class="use-case-item">
                            <h4>üå≤ Survivalists & Preppers</h4>
                            <p>Water procurement strategies, plant/mushroom identification, shelter construction guides, food preservation methods, and emergency planning.</p>
                        </div>
                        
                        <div class="use-case-item">
                            <h4>üè• Healthcare Professionals</h4>
                            <p>Clinical documentation assistance, multi-lingual patient instructions, wound assessment documentation, drug interaction checks, and training materials.</p>
                        </div>
                        
                        <div class="use-case-item">
                            <h4>üîß Trades & Technical Work</h4>
                            <p>Diagnostic support, code compliance reference, parts identification from photos, complex calculations, and safety protocol guidance.</p>
                        </div>
                        
                        <div class="use-case-item">
                            <h4>üåç Field Researchers & NGOs</h4>
                            <p>Data pattern analysis, species identification, report generation, cultural translation, and resource mapping in remote locations.</p>
                        </div>
                        
                        <div class="use-case-item">
                            <h4>üë®‚Äçüè´ Remote Educators</h4>
                            <p>Lesson planning without internet, hands-on science activities, curriculum development, and educational content creation.</p>
                        </div>
                        
                        <div class="highlight-box">
                            <strong>Perfect for anyone who:</strong>
                            <ul>
                                <li>Works in areas with unreliable internet</li>
                                <li>Values complete privacy and data control</li>
                                <li>Needs AI assistance in emergency situations</li>
                                <li>Wants to own their AI tools without subscriptions</li>
                            </ul>
                        </div>
                        
                        <div class="cta-box">
                            <h4>üõí Ready to Go Off-Grid?</h4>
                            <p>Get the USB version for complete offline capability.</p>
                            <a href="https://offgridaitoolkit.com" target="_blank" class="cta-button">Purchase USB Version ‚Üí</a>
                        </div>
                        
                        <p class="continue-prompt">üí¨ Tell me about your use case and I'll show you how OffGrid AI can help!</p>
                    </div>
                `
            },
            benchmarks: {
                title: "Testing & Benchmarks",
                content: `
                    <div class="info-content">
                        <h3>üìä Why We Chose Gemma 3</h3>
                        <p>We tested 15+ model families with 300+ survival-focused prompts. Standard benchmarks don't test what matters for real-world survival situations, so we built our own rigorous testing methodology.</p>
                        
                        <div class="highlight-box">
                            <strong>Our Testing Categories:</strong>
                            <ul>
                                <li><strong>Survival & Emergency Knowledge:</strong> Water purification, shelter building, navigation, first aid</li>
                                <li><strong>Intelligence & Problem Solving:</strong> Logic puzzles, adaptive reasoning, scenario analysis</li>
                            </ul>
                        </div>
                        
                        <h3>üèÜ Survival AI Testing Results</h3>
                        <table class="benchmark-table">
                            <tr>
                                <th>Model</th>
                                <th>Accuracy</th>
                                <th>Reasoning</th>
                                <th>Avg Score</th>
                            </tr>
                            <tr>
                                <td>ü•á <strong>Gemma3 27B</strong></td>
                                <td>9.95/10</td>
                                <td>9.9/10</td>
                                <td><strong>9.91</strong></td>
                            </tr>
                            <tr>
                                <td>ü•à <strong>Gemma3 12B</strong></td>
                                <td>9.9/10</td>
                                <td>9.8/10</td>
                                <td><strong>9.83</strong></td>
                            </tr>
                            <tr>
                                <td>ü•â <strong>Gemma3 4B</strong></td>
                                <td>9.6/10</td>
                                <td>9.3/10</td>
                                <td><strong>9.43</strong></td>
                            </tr>
                            <tr>
                                <td>Deepseek-r1 14b</td>
                                <td>9.1/10</td>
                                <td>9.0/10</td>
                                <td>9.16</td>
                            </tr>
                        </table>
                        
                        <h3>üî¨ Key Finding</h3>
                        <p><strong>Gemma models consistently outperformed all others</strong> for real-world applications. They're not just regurgitating facts - they're thinking through scenarios and adapting to unique situations.</p>
                        
                        <h3>‚úÖ What We Test For</h3>
                        <ul>
                            <li><strong>Accuracy:</strong> Factually correct information</li>
                            <li><strong>Reasoning:</strong> Logical problem-solving ability</li>
                            <li><strong>Clarity:</strong> Easy to understand responses</li>
                            <li><strong>Safety:</strong> Appropriate warnings and disclaimers</li>
                            <li><strong>Offline Fit:</strong> Works well without internet context</li>
                        </ul>
                        
                        <div class="cta-box">
                            <h4>üõí Experience the Difference</h4>
                            <p>Try the same models that topped our benchmarks.</p>
                            <a href="https://offgridaitoolkit.com" target="_blank" class="cta-button">Get the USB Version ‚Üí</a>
                        </div>
                        
                        <p class="continue-prompt">üí¨ Want to test the AI yourself? Ask me a survival question!</p>
                    </div>
                `
            },
            modelSelection: {
                title: "Choosing the Right Model",
                content: `
                    <div class="info-content">
                        <h3>üß† Model Selection Guide</h3>
                        <p>OffGrid AI includes multiple Gemma 3 models. Each has different strengths - here's how to choose:</p>
                        
                        <div class="model-card">
                            <h4>Gemma 3 4B <span class="badge badge-fast">‚ö° Fastest</span></h4>
                            <p><strong>Best for:</strong> Quick questions, simple lookups, basic guidance</p>
                            <p><strong>Speed:</strong> 2-5 seconds response time</p>
                            <p><strong>Use when:</strong> You need fast answers and don't require deep analysis</p>
                        </div>
                        
                        <div class="model-card">
                            <h4>Gemma 3 12B <span class="badge badge-fast">‚ö° Fast</span> <span class="badge badge-smart">üéØ Recommended</span></h4>
                            <p><strong>Best for:</strong> Most tasks - perfect balance of speed and intelligence</p>
                            <p><strong>Speed:</strong> 5-15 seconds response time</p>
                            <p><strong>Use when:</strong> You want reliable, thorough answers without long waits</p>
                        </div>
                        
                        <div class="model-card">
                            <h4>Gemma 3 27B <span class="badge badge-smart">üß† Smartest</span></h4>
                            <p><strong>Best for:</strong> Complex scenarios, detailed analysis, critical decisions</p>
                            <p><strong>Speed:</strong> 15-45 seconds response time</p>
                            <p><strong>Use when:</strong> Accuracy matters more than speed</p>
                        </div>
                        
                        <div class="model-card">
                            <h4>MedGemma 4B <span class="badge badge-medical">üè• Medical</span></h4>
                            <p><strong>Best for:</strong> Health questions, medical image analysis, clinical documentation</p>
                            <p><strong>Note:</strong> Available only in the USB version for complete privacy</p>
                            <p><strong>Use when:</strong> You need medical-specific knowledge and guidance</p>
                        </div>
                        
                        <div class="highlight-box">
                            <strong>üí° Pro Tip:</strong> Start with the 12B model for most questions. Switch to 27B for complex survival scenarios or when you need maximum accuracy. Use 4B when you just need a quick reference.
                        </div>
                        
                        <h3>üîÑ Easy Model Switching</h3>
                        <p>You can switch models anytime using the dropdown at the bottom of the chat. Your conversation continues seamlessly.</p>
                        
                        <div class="cta-box">
                            <h4>üõí Get All Models + MedGemma</h4>
                            <p>The USB version includes all models plus the medical-specialized MedGemma.</p>
                            <a href="https://offgridaitoolkit.com" target="_blank" class="cta-button">Purchase USB Version ‚Üí</a>
                        </div>
                        
                        <p class="continue-prompt">üí¨ Try switching models using the dropdown below and see the difference!</p>
                    </div>
                `
            }
        };
        
        // ============================================
        // INFO CONTENT DISPLAY FUNCTION
        // ============================================
        
        function showInfoContent(contentKey) {
            const content = infoContent[contentKey];
            if (!content) return;
            
            // Remove welcome screen
            const welcome = document.getElementById('welcome');
            if (welcome) welcome.remove();
            
            // Add the info content as an assistant message
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message assistant';
            
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-avatar">AI</div>
                <div class="message-content">
                    <div class="message-text markdown-content">
                        <h2 style="color: #daa520; margin-bottom: 16px;">${content.title}</h2>
                        ${content.content}
                    </div>
                    <div class="message-time">${time}</div>
                </div>
            `;
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            // Focus input for follow-up questions
            document.getElementById('messageInput').focus();
        }
        
        // ============================================
        // CONNECTION HANDLING
        // ============================================
        
        async function checkConnection() {
            try {
                const response = await fetch(`${API_BASE}/api/health`, {
                    method: 'GET',
                    cache: 'no-cache'
                });
                
                if (response.ok) {
                    document.getElementById('statusDot').className = 'status-dot connected';
                    document.getElementById('statusText').textContent = 'Connected';
                    return true;
                }
            } catch (error) {
                console.log('Connection check failed:', error);
            }
            
            document.getElementById('statusDot').className = 'status-dot disconnected';
            document.getElementById('statusText').textContent = 'Disconnected';
            return false;
        }
        
        // ============================================
        // MODEL SELECTION
        // ============================================
        
        function toggleModelDropdown() {
            const dropdown = document.getElementById('modelDropdown');
            dropdown.classList.toggle('show');
        }
        
        function selectModel(model) {
            selectedModel = model;
            
            const modelNames = {
                'gemma-3-4b': 'Gemma 3 4B',
                'gemma-3-12b': 'Gemma 3 12B',
                'gemma-3-27b': 'Gemma 3 27B'
            };
            
            const speedBadges = {
                'gemma-3-4b': '‚ö° Fastest',
                'gemma-3-12b': '‚ö° Fast',
                'gemma-3-27b': 'üß† Smartest'
            };
            
            document.getElementById('selectedModelName').textContent = modelNames[model] || model;
            document.querySelector('#modelButton .model-speed-badge').textContent = speedBadges[model] || '';
            
            // Update selected state in dropdown
            document.querySelectorAll('.model-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.target.closest('.model-item')?.classList.add('selected');
            
            toggleModelDropdown();
        }
        
        function showOfflineOnlyAlert() {
            alert('MedGemma is available exclusively in the USB version for complete medical privacy.\n\nVisit offgridaitoolkit.com to get the full offline version with MedGemma included.');
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('modelDropdown');
            const button = document.getElementById('modelButton');
            
            if (!button.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });
        
        // ============================================
        // MESSAGING
        // ============================================
        
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            const requestStartTime = Date.now();
            
            if ((!message && !selectedImage) || isTyping) return;
            
            const isConnected = await checkConnection();
            if (!isConnected) {
                addMessage('Cannot connect to the server. Please refresh the page and try again.', 'assistant', true);
                return;
            }
            
            // Remove welcome screen
            const welcome = document.getElementById('welcome');
            if (welcome) welcome.remove();
            
            // Add user message to UI
            const userMessage = message || "What's in this image?";
            if (selectedImage) {
                addMessageWithImage(userMessage, selectedImage.dataUrl, 'user');
            } else {
                addMessage(userMessage, 'user');
            }
            
            // Add to conversation history
            const historyEntry = {
                role: 'user',
                content: userMessage
            };
            if (selectedImage) {
                historyEntry.image = selectedImage.dataUrl;
            }
            conversationHistory.push(historyEntry);
            
            // Clear input
            input.value = '';
            autoResize(input);
            const imageToSend = selectedImage;
            removeImage();
            
            // Set typing state
            isTyping = true;
            document.getElementById('sendButton').disabled = true;
            
            const typingDiv = showTyping();
            
            try {
                // Prepare messages for API
                const messages = conversationHistory.map(msg => ({
                    role: msg.role,
                    content: msg.content,
                    image: msg.image
                }));
                
                const response = await fetch(`${API_BASE}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: selectedModel,
                        messages: messages
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                typingDiv.remove();
                
                // Calculate and display response time
                const responseTime = ((Date.now() - requestStartTime) / 1000).toFixed(1);
                
                // Show response time indicator
                const messagesDiv = document.getElementById('messages');
                const timeIndicator = document.createElement('div');
                timeIndicator.className = 'response-time';
                timeIndicator.innerHTML = `‚ö° ${data.model} ‚Ä¢ ${responseTime}s response time`;
                messagesDiv.appendChild(timeIndicator);
                
                // Add assistant response
                addMessage(data.response, 'assistant');
                
                // Add to conversation history
                conversationHistory.push({
                    role: 'assistant',
                    content: data.response
                });
                
            } catch (error) {
                console.error('Error:', error);
                typingDiv.remove();
                addMessage('Error: ' + error.message, 'assistant', true);
            } finally {
                isTyping = false;
                document.getElementById('sendButton').disabled = false;
                document.getElementById('messageInput').focus();
            }
        }
        
        function addMessage(text, sender, isError = false) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Parse markdown for assistant messages
            let displayText = text;
            if (sender === 'assistant' && typeof marked !== 'undefined') {
                displayText = marked.parse(text);
            } else {
                displayText = escapeHtml(text);
            }
            
            const avatar = sender === 'user' ? 'U' : 'AI';
            const errorClass = isError ? 'style="color: #ef4444;"' : '';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <div class="message-text markdown-content" ${errorClass}>${displayText}</div>
                    <div class="message-time">${time}</div>
                </div>
            `;
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function addMessageWithImage(text, imageUrl, sender) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${sender === 'user' ? 'U' : 'AI'}</div>
                <div class="message-content">
                    <div class="message-text">${escapeHtml(text)}</div>
                    <img class="message-image" src="${imageUrl}" alt="Uploaded image" style="max-width: 300px; border-radius: 8px; margin-top: 8px;">
                    <div class="message-time">${time}</div>
                </div>
            `;
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function showTyping() {
            const messagesDiv = document.getElementById('messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message assistant';
            typingDiv.innerHTML = `
                <div class="message-avatar">AI</div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            messagesDiv.appendChild(typingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            return typingDiv;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ============================================
        // IMAGE HANDLING
        // ============================================
        
        function triggerImageUpload() {
            document.getElementById('imageInput').click();
        }
        
        function triggerGalleryUpload() {
            document.getElementById('galleryInput').click();
        }
        
        function handleImageSelect(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                // Show loading indicator on mobile
                if (window.innerWidth <= 768) {
                    const indicator = document.getElementById('uploadIndicator');
                    indicator.classList.add('active');
                    setTimeout(() => indicator.classList.remove('active'), 2000);
                }
                
                resizeImage(file, 1024, 1024, function(resizedDataUrl) {
                    selectedImage = {
                        base64: resizedDataUrl.split(',')[1],
                        name: file.name,
                        dataUrl: resizedDataUrl
                    };
                    showImagePreview();
                    
                    // Show helper for MedGemma
                    if (selectedModel === 'medgemma-3-4b') {
                        const helper = document.getElementById('modelHelper');
                        helper.textContent = 'üè• MedGemma supports medical image analysis';
                        helper.classList.add('show');
                        setTimeout(() => helper.classList.remove('show'), 3000);
                    }
                });
            }
        }
        
        function resizeImage(file, maxWidth, maxHeight, callback) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > maxWidth || height > maxHeight) {
                        const ratio = Math.min(maxWidth / width, maxHeight / height);
                        width *= ratio;
                        height *= ratio;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    callback(canvas.toDataURL('image/jpeg', 0.85));
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function showImagePreview() {
            const preview = document.getElementById('imagePreview');
            const previewImg = document.getElementById('previewImg');
            const previewFilename = document.getElementById('previewFilename');
            
            previewImg.src = selectedImage.dataUrl;
            previewFilename.textContent = selectedImage.name;
            preview.classList.add('active');
        }
        
        function removeImage() {
            selectedImage = null;
            document.getElementById('imagePreview').classList.remove('active');
            document.getElementById('imageInput').value = '';
            document.getElementById('galleryInput').value = '';
        }
        
        // ============================================
        // UI FUNCTIONS
        // ============================================
        
        function clearChat() {
            if (confirm('Clear all messages and return to home? This will start a new session.')) {
                conversationHistory = [];
                location.reload();
            }
        }
        
        function returnToHome() {
            const messagesContainer = document.getElementById('messages');
            const hasMessages = messagesContainer && messagesContainer.children.length > 1;
            const hasWelcome = !!document.getElementById('welcome');
            
            if (hasMessages || !hasWelcome) {
                if (confirm('Return to home? This will start a new session.')) {
                    conversationHistory = [];
                    location.reload();
                }
            }
        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleButton = document.querySelector('.toggle-sidebar');
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('mobile-visible');
                if (toggleButton) {
                    toggleButton.classList.toggle('menu-open');
                }
            } else {
                sidebar.classList.toggle('hidden');
            }
        }
        
        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }
        
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 150) + 'px';
        }
        
        function sendQuickPrompt(prompt) {
            document.getElementById('messageInput').value = prompt;
            sendMessage();
        }
        
        function setupTranslator() {
            const input = document.getElementById('messageInput');
            const translatorPrompt = 'Translate "[paste or type your text here]" to [Spanish/French/Chinese/etc]';
            
            input.value = translatorPrompt;
            autoResize(input);
            
            setTimeout(() => {
                input.focus();
                const start = translatorPrompt.indexOf('[paste');
                const end = translatorPrompt.indexOf(']') + 1;
                input.setSelectionRange(start, end);
            }, 100);
        }
        
        function openImageIdentifier() {
            const input = document.getElementById('messageInput');
            input.value = 'Please identify what is in this image and provide detailed information about it.';
            autoResize(input);
            triggerGalleryUpload();
        }
        
        // ============================================
        // PROMPT ACCORDION FUNCTIONS
        // ============================================
        
        let activeCategory = null;
        
        function togglePromptCategory(category) {
            const promptList = document.getElementById(category + '-prompts');
            const toggle = document.querySelector(`[data-category="${category}"] .prompt-category-toggle`);
            
            // If clicking the same category, just close it
            if (activeCategory === category) {
                promptList.classList.remove('open');
                toggle.classList.remove('active');
                activeCategory = null;
                return;
            }
            
            // Close any previously open category
            if (activeCategory) {
                const prevList = document.getElementById(activeCategory + '-prompts');
                const prevToggle = document.querySelector(`[data-category="${activeCategory}"] .prompt-category-toggle`);
                if (prevList) prevList.classList.remove('open');
                if (prevToggle) prevToggle.classList.remove('active');
            }
            
            // Open the clicked category
            promptList.classList.add('open');
            toggle.classList.add('active');
            activeCategory = category;
        }
        
        function copyPrompt(element) {
            const promptText = element.textContent.trim();
            
            // Copy to clipboard
            navigator.clipboard.writeText(promptText).then(() => {
                // Show success toast
                showCopyToast('‚úÖ Prompt copied! Paste it in the chat input.');
                
                // Also put it in the input field for convenience
                const input = document.getElementById('messageInput');
                input.value = promptText;
                autoResize(input);
                input.focus();
                
                // If it's an image prompt, trigger the image upload
                if (promptText.includes('[Take picture or upload image]')) {
                    setTimeout(() => {
                        triggerGalleryUpload();
                    }, 300);
                }
                
                // Close sidebar on mobile after copying
                if (window.innerWidth <= 768) {
                    const sidebar = document.getElementById('sidebar');
                    const toggleButton = document.querySelector('.toggle-sidebar');
                    sidebar.classList.remove('mobile-visible');
                    if (toggleButton) toggleButton.classList.remove('menu-open');
                }
            }).catch(err => {
                console.error('Failed to copy:', err);
                // Fallback: just put it in the input
                const input = document.getElementById('messageInput');
                input.value = promptText;
                autoResize(input);
                input.focus();
                showCopyToast('üìã Prompt added to input!');
            });
        }
        
        function showCopyToast(message) {
            // Remove any existing toast
            const existingToast = document.querySelector('.copy-toast');
            if (existingToast) existingToast.remove();
            
            // Create new toast
            const toast = document.createElement('div');
            toast.className = 'copy-toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // Remove after animation
            setTimeout(() => {
                if (toast.parentNode) toast.remove();
            }, 2000);
        }
        
        // ============================================
        // FIRST RUN HANDLING
        // ============================================
        
        function acceptFirstRun() {
            localStorage.setItem('offgrid-online-initialized', 'true');
            localStorage.setItem('offgrid-online-init-date', new Date().toISOString());
            
            const banner = document.getElementById('firstRunBanner');
            if (banner) {
                banner.style.transition = 'opacity 0.3s ease';
                banner.style.opacity = '0';
                setTimeout(() => {
                    banner.style.display = 'none';
                }, 300);
            }
        }
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('OffGrid AI ToolKit Online - Initializing...');
            
            // Check first run
            if (!localStorage.getItem('offgrid-online-initialized')) {
                const banner = document.getElementById('firstRunBanner');
                const checkbox = document.getElementById('acceptTermsBanner');
                const button = document.getElementById('acceptBannerBtn');
                
                if (banner && checkbox && button) {
                    banner.style.display = 'block';
                    
                    checkbox.addEventListener('change', function() {
                        button.disabled = !this.checked;
                        button.style.opacity = this.checked ? '1' : '0.5';
                        button.style.cursor = this.checked ? 'pointer' : 'not-allowed';
                    });
                }
            }
            
            // Initialize connection check
            checkConnection();
            setInterval(checkConnection, 10000);
            
            // Focus input
            document.getElementById('messageInput').focus();
            
            // Fix initial textarea height
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                autoResize(messageInput);
            }
            
            console.log('OffGrid AI ToolKit Online - Ready!');
        });
    </script>
</body>
</html>
